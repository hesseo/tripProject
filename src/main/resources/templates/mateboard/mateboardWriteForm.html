<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-bs4.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-bs4.min.js"></script>
</head>
<body>


<style type="text/css">
.container {
   width: 1200px;
   margin: auto;
   margin-top: 30px;
}
input[id="title"] {
	width: 100px; 
	background: #ff9000; 
	height: 40px; 
	margin-bottom: -3px; 
	display: inline-block;
	border-radius: 10px 0 0 0;
	border-color: #808080;
	text-align: center;
	font-weight: bold;
	color: white;
}
input[name="subject"] {
	width: 1196px; 
	height: 40px; 
	margin-bottom: -3px; 
	margin-left: -6px;
	display: inline-block;
	border-radius: 0 10px 0 0; 
	display: inline-block;
}
</style>

<script>
function imageUploader(file, el) {
	var formData = new FormData();
	formData.append("file", file);
  
	$.ajax({                                                              
		data : formData,
		type : 'POST',
        // url은 자신의 이미지 업로드 처리 컨트롤러 경로로 설정해주세요.
		url : '/mateboardImageUpload',  
		contentType : false,
		processData : false,
		enctype : "multipart/form-data",
		success : function(data) {   
			var imageUrl = '/mateImage/' + data;
			$(el).summernote('insertImage', imageUrl, function($image) {
				popover: {
					  image: [
					    ['image', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
					    ['float', ['floatLeft', 'floatRight', 'floatNone']],
					    ['remove', ['removeMedia']]
					  ]		
				}
			});
		}
	});
}

function mateboardImageDelete(imageName) {
    data = new FormData()
    data.append('file', imageName)
    $.ajax({
        data: data,
        type: 'POST',
        url: '/mateboardImageDelete',
        contentType: false,
        enctype: 'multipart/form-data',
        processData: false,
    })
}

function deleteImageOnBackspace(event) {
    if (event.keyCode === 8) {  // Backspace 키가 눌리면
        var $target = $(event.target);  // 현재 타겟 요소 가져오기
        
        // 만약 해당 타겟이 이미지라면
        if ($target.is('img')) {
            var imageName = $target.attr('src').split('/').pop();  // 이미지 이름 추출
            mateboardImageDelete(imageName);  // 이미지 삭제 함수 호출
	    }	
	}
}


$(document).ready(function() {
	$('#summernote').summernote({
		placeholder: 'Hello Bootstrap 4',
		tabsize: 2,
		width: 1296,
		height: 525,
		disableResizeEditor: true,
		lang: 'ko-KR',
		fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋음체','바탕체'],
		fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72','96'],
		// 네모 맞추기
		callbacks: {
			onInit: function() {
				$('.note-editor').css({
					'border-radius': '0 0 10px 10px'
				});
			},
			onImageUpload : function(files, editor, welEditable) {   
	            // 다중 이미지 처리를 위해 for문
				for (var i = 0; i < files.length; i++) {
					imageUploader(files[i], this);
				}
			},
            onMediaDelete: function ($target, editor, $editable) {
                if (confirm('이미지를 삭제 하시겠습니까?')) {
                    var imageName = $target
                        .attr('src')
                        .split('/')
                        .pop()

                    // ajax 함수 호출
                    mateboardImageDelete(imageName)
                }
            }, 
			onKeydown: function(event) { 	// 함수 호출(뒤로가기 이미지 삭제)
				deleteImageOnBackspace(event);
			}
		}
    });
});


</script> 

<div th:replace="~{layouts/header}"></div>	

<div class="container">
    <p style="color: #ff9000; margin-top: 30px; margin-left: 10px; margin-bottom: 0px; font-weight: bold; font-size: 30px;">TRIP MATE</p>
    <hr style="border-width:2px; margin-bottom: 10px; margin-top: 5px;">
    <table>
		<tr>
		    <td colspan="2">
		    	<input type="text" id="title" value="제 목">
		    	<input type="text" class="form-control" name="subject">
		    </td>
		</tr>
    	<tr>
    		<td>
				<textarea id="summernote" style="margin: auto;"></textarea>
			</td>
	    </tr>   
    </table>

</div>

<div th:replace="~{layouts/footer}"></div>	
</body>
</html>